<?php

// If uninstall not called from WordPress, then exit.
if ( ! defined( 'WP_UNINSTALL_PLUGIN' ) ) {
	exit;
}

// Delete Options
delete_option('dfehc_heartbeat_zoom');
delete_site_option('dfehc_heartbeat_zoom');
delete_option('dfehc_priority_slider');
delete_site_option('dfehc_priority_slider');
delete_option('dfehc_optimization_frequency');
delete_site_option('dfehc_optimization_frequency');
delete_option('dfhcsl_backend_heartbeat_control');
delete_site_option('dfhcsl_backend_heartbeat_control');
delete_option('dfhcsl_editor_heartbeat_control');
delete_site_option('dfhcsl_editor_heartbeat_control');
delete_option('dfhcsl_backend_heartbeat_interval');
delete_site_option('dfhcsl_backend_heartbeat_interval');
delete_option('dfhcsl_editor_heartbeat_interval');
delete_site_option('dfhcsl_editor_heartbeat_interval');
delete_option('dfehc_redis_server');
delete_site_option('dfehc_redis_server');
delete_option('dfehc_redis_port');
delete_site_option('dfehc_redis_port');
delete_option('dfehc_memcached_server');
delete_site_option('dfehc_memcached_server');
delete_option('dfehc_memcached_port');
delete_site_option('dfehc_memcached_port');
delete_option('dfehc_redis_socket');
delete_site_option('dfehc_redis_socket');
delete_option('dfehc_disable_heartbeat');
delete_site_option('dfehc_disable_heartbeat');
delete_option('add_to_menu');
delete_site_option('add_to_menu');
delete_option('dfehc_client_ip_public_only');
delete_site_option('dfehc_client_ip_public_only');
delete_option('dfehc_trusted_proxies');
delete_site_option('dfehc_trusted_proxies');
delete_option('dfehc_proxy_ip_headers');
delete_site_option('dfehc_proxy_ip_headers');
delete_option('dfehc_client_ip');
delete_site_option('dfehc_client_ip');
delete_option('dfehc_default_response_time');
delete_site_option('dfehc_default_response_time');
delete_option('dfehc_spike_threshold_factor');
delete_site_option('dfehc_spike_threshold_factor');
delete_option('dfehc_spike_increment_floor');
delete_site_option('dfehc_spike_increment_floor');
delete_option('dfehc_spike_increment_cap');
delete_site_option('dfehc_spike_increment_cap');
delete_option('dfehc_spike_decay');
delete_site_option('dfehc_spike_decay');
delete_option('dfehc_recalibrate_threshold');
delete_site_option('dfehc_recalibrate_threshold');
delete_option('dfehc_trim_extremes');
delete_site_option('dfehc_trim_extremes');
delete_option('dfehc_high_traffic_cache_expiration');
delete_site_option('dfehc_high_traffic_cache_expiration');
delete_option('dfehc_max_baseline_age');
delete_site_option('dfehc_max_baseline_age');
delete_option('dfehc_baseline_min_samples');
delete_site_option('dfehc_baseline_min_samples');
delete_option('dfehc_baseline_expiration');
delete_site_option('dfehc_baseline_expiration');
delete_option('dfehc_cache_expiration');
delete_site_option('dfehc_cache_expiration');
delete_option('dfehc_head_negative_ttl');
delete_site_option('dfehc_head_negative_ttl');
delete_option('dfehc_head_positive_ttl');
delete_site_option('dfehc_head_positive_ttl');
delete_option('dfehc_probe_fail_ttl');
delete_site_option('dfehc_probe_fail_ttl');
delete_option('dfehc_disable_loopback');
delete_site_option('dfehc_disable_loopback');
delete_option('dfehc_probe_headers');
delete_site_option('dfehc_probe_headers');
delete_option('dfehc_total_timeout');
delete_site_option('dfehc_total_timeout');
delete_option('dfehc_request_timeout');
delete_site_option('dfehc_request_timeout');
delete_option('dfehc_num_requests');
delete_site_option('dfehc_num_requests');
delete_option('dfehc_request_pause_us');
delete_site_option('dfehc_request_pause_us');
delete_option('dfehc_ssl_verify');
delete_site_option('dfehc_ssl_verify');
delete_option('dfehc_use_get_fallback');
delete_site_option('dfehc_use_get_fallback');
delete_option('dfehc_use_head_method');
delete_site_option('dfehc_use_head_method');
delete_option('dfehc_redirection');
delete_site_option('dfehc_redirection');
delete_option('dfehc_limit_response_size');
delete_site_option('dfehc_limit_response_size');
delete_option('dfehc_ping_rl_ttl');
delete_site_option('dfehc_ping_rl_ttl');
delete_option('dfehc_ping_rl_limit');
delete_site_option('dfehc_ping_rl_limit');
delete_option('dfehc_enable_public_ping');
delete_site_option('dfehc_enable_public_ping');
delete_option('dfehc_high_traffic_threshold');
delete_site_option('dfehc_high_traffic_threshold');
delete_option('dfehc_website_visitors');
delete_site_option('dfehc_website_visitors');
delete_option('dfehc_current_server_load');
delete_site_option('dfehc_current_server_load');
delete_option('dfehc_high_traffic_load_threshold');
delete_site_option('dfehc_high_traffic_load_threshold');
delete_option('dfehc_allow_public_server_load');
delete_site_option('dfehc_allow_public_server_load');
delete_option('dfehc_allow_public_async');
delete_site_option('dfehc_allow_public_async');
delete_option('dfehc_min_interval');
delete_site_option('dfehc_min_interval');
delete_option('dfehc_max_interval');
delete_site_option('dfehc_max_interval');
delete_option('dfehc_fallback_interval');
delete_site_option('dfehc_fallback_interval');
delete_option('dfehc_unknown_load');
delete_site_option('dfehc_unknown_load');
delete_option('dfehc_max_server_load');
delete_site_option('dfehc_max_server_load');
delete_option('dfehc_interval_factors');
delete_site_option('dfehc_interval_factors');
delete_option('dfehc_interval_weights');
delete_site_option('dfehc_interval_weights');
delete_option('dfehc_load_weights');
delete_site_option('dfehc_load_weights');
delete_option('dfehc_normalize_load');
delete_site_option('dfehc_normalize_load');
delete_option('dfehc_assumed_cores_for_normalization');
delete_site_option('dfehc_assumed_cores_for_normalization');
delete_option('dfehc_max_increase_rate');
delete_site_option('dfehc_max_increase_rate');
delete_option('dfehc_interval_snap');
delete_site_option('dfehc_interval_snap');
delete_option('dfehc_response_time_is_ms');
delete_site_option('dfehc_response_time_is_ms');
delete_option('dfehc_contextual_load_value');
delete_site_option('dfehc_contextual_load_value');
delete_option('dfehc_divide_cpu_load');
delete_site_option('dfehc_divide_cpu_load');
delete_option('dfehc_cpu_cores');
delete_site_option('dfehc_cpu_cores');
delete_option('dfehc_server_load_ttl');
delete_site_option('dfehc_server_load_ttl');
delete_option('dfehc_transient_ttl');
delete_site_option('dfehc_transient_ttl');
delete_option('dfehc_ema_ttl');
delete_site_option('dfehc_ema_ttl');
delete_option('dfehc_prev_interval_ttl');
delete_site_option('dfehc_prev_interval_ttl');
delete_option('dfehc_cache_retry_after');
delete_site_option('dfehc_cache_retry_after');
delete_option('dfehc_redis_auth');
delete_site_option('dfehc_redis_auth');
delete_option('dfehc_redis_user');
delete_site_option('dfehc_redis_user');
delete_option('dfehc_required_capability');
delete_site_option('dfehc_required_capability');
delete_option('dfehc_public_rate_limit');
delete_site_option('dfehc_public_rate_limit');
delete_option('dfehc_public_rate_window');
delete_site_option('dfehc_public_rate_window');
delete_option('dfehc_enable_load_logging');
delete_site_option('dfehc_enable_load_logging');
delete_option('dfehc_log_retention_seconds');
delete_site_option('dfehc_log_retention_seconds');
delete_option('dfehc_log_retention_max');
delete_site_option('dfehc_log_retention_max');
delete_option('dfehc_prune_chunk_size');
delete_site_option('dfehc_prune_chunk_size');
delete_option('dfehc_unclogger_settings');
delete_site_option('dfehc_unclogger_settings');
delete_option('dfehc_heartbeat_control_enabled');
delete_site_option('dfehc_heartbeat_control_enabled');
delete_option('dfehc_server_load_logs');
delete_site_option('dfehc_server_load_logs');
delete_option('dfehc_server_load_logs_last_saved');
delete_site_option('dfehc_server_load_logs_last_saved');
delete_option('dfehc_update_load_logs_option');
delete_site_option('dfehc_update_load_logs_option');
delete_option('dfehc_max_response_time');
delete_site_option('dfehc_max_response_time');
delete_option('dfehc_ema_alpha');
delete_site_option('dfehc_ema_alpha');

// Delete Transients
delete_transient('dfehc_optimization_flash');
delete_site_transient('dfehc_optimization_flash');
delete_transient('dfehc_optimizing');
delete_site_transient('dfehc_optimizing');
global $wpdb;
$transients = $wpdb->get_col( $wpdb->prepare( "SELECT option_name FROM {$wpdb->options} WHERE option_name LIKE %s OR option_name LIKE %s", '_transient_%_t', '_site_transient_%_t' ) );
foreach ( $transients as $transient ) {
	delete_option( $transient );
}
delete_transient('dfehc_heartbeat_health_status');
delete_site_transient('dfehc_heartbeat_health_status');

// Clear Cron Jobs
wp_clear_scheduled_hook('dfehc_async_optimize_all');
wp_clear_scheduled_hook('dfehc_log_server_load_hook');
wp_clear_scheduled_hook('dfehc_periodic_optimization');
wp_clear_scheduled_hook('dfehc_process_user_activity');
wp_clear_scheduled_hook('dfehc_cleanup_user_activity');
wp_clear_scheduled_hook('dfehc_reset_total_visitors_event');

// Clear Metadata
global $wpdb;
$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->postmeta} WHERE meta_key = %s", 'dfehc_user_activity' ) );
$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->usermeta} WHERE meta_key = %s", 'dfehc_user_activity' ) );
$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->termmeta} WHERE meta_key = %s", 'dfehc_user_activity' ) );
$wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->commentmeta} WHERE meta_key = %s", 'dfehc_user_activity' ) );

