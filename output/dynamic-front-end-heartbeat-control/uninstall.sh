#!/bin/bash
# WP-CLI Uninstall Script

# Delete Options
wp option delete 'dfehc_heartbeat_zoom'
wp option delete 'dfehc_priority_slider'
wp option delete 'dfehc_optimization_frequency'
wp option delete 'dfhcsl_backend_heartbeat_control'
wp option delete 'dfhcsl_editor_heartbeat_control'
wp option delete 'dfhcsl_backend_heartbeat_interval'
wp option delete 'dfhcsl_editor_heartbeat_interval'
wp option delete 'dfehc_redis_server'
wp option delete 'dfehc_redis_port'
wp option delete 'dfehc_memcached_server'
wp option delete 'dfehc_memcached_port'
wp option delete 'dfehc_redis_socket'
wp option delete 'dfehc_disable_heartbeat'
wp option delete 'add_to_menu'
wp option delete 'dfehc_client_ip_public_only'
wp option delete 'dfehc_trusted_proxies'
wp option delete 'dfehc_proxy_ip_headers'
wp option delete 'dfehc_client_ip'
wp option delete 'dfehc_default_response_time'
wp option delete 'dfehc_spike_threshold_factor'
wp option delete 'dfehc_spike_increment_floor'
wp option delete 'dfehc_spike_increment_cap'
wp option delete 'dfehc_spike_decay'
wp option delete 'dfehc_recalibrate_threshold'
wp option delete 'dfehc_trim_extremes'
wp option delete 'dfehc_high_traffic_cache_expiration'
wp option delete 'dfehc_max_baseline_age'
wp option delete 'dfehc_baseline_min_samples'
wp option delete 'dfehc_baseline_expiration'
wp option delete 'dfehc_cache_expiration'
wp option delete 'dfehc_head_negative_ttl'
wp option delete 'dfehc_head_positive_ttl'
wp option delete 'dfehc_probe_fail_ttl'
wp option delete 'dfehc_disable_loopback'
wp option delete 'dfehc_probe_headers'
wp option delete 'dfehc_total_timeout'
wp option delete 'dfehc_request_timeout'
wp option delete 'dfehc_num_requests'
wp option delete 'dfehc_request_pause_us'
wp option delete 'dfehc_ssl_verify'
wp option delete 'dfehc_use_get_fallback'
wp option delete 'dfehc_use_head_method'
wp option delete 'dfehc_redirection'
wp option delete 'dfehc_limit_response_size'
wp option delete 'dfehc_ping_rl_ttl'
wp option delete 'dfehc_ping_rl_limit'
wp option delete 'dfehc_enable_public_ping'
wp option delete 'dfehc_high_traffic_threshold'
wp option delete 'dfehc_website_visitors'
wp option delete 'dfehc_current_server_load'
wp option delete 'dfehc_high_traffic_load_threshold'
wp option delete 'dfehc_allow_public_server_load'
wp option delete 'dfehc_allow_public_async'
wp option delete 'dfehc_min_interval'
wp option delete 'dfehc_max_interval'
wp option delete 'dfehc_fallback_interval'
wp option delete 'dfehc_unknown_load'
wp option delete 'dfehc_max_server_load'
wp option delete 'dfehc_interval_factors'
wp option delete 'dfehc_interval_weights'
wp option delete 'dfehc_load_weights'
wp option delete 'dfehc_normalize_load'
wp option delete 'dfehc_assumed_cores_for_normalization'
wp option delete 'dfehc_max_increase_rate'
wp option delete 'dfehc_interval_snap'
wp option delete 'dfehc_response_time_is_ms'
wp option delete 'dfehc_contextual_load_value'
wp option delete 'dfehc_divide_cpu_load'
wp option delete 'dfehc_cpu_cores'
wp option delete 'dfehc_server_load_ttl'
wp option delete 'dfehc_transient_ttl'
wp option delete 'dfehc_ema_ttl'
wp option delete 'dfehc_prev_interval_ttl'
wp option delete 'dfehc_cache_retry_after'
wp option delete 'dfehc_redis_auth'
wp option delete 'dfehc_redis_user'
wp option delete 'dfehc_required_capability'
wp option delete 'dfehc_public_rate_limit'
wp option delete 'dfehc_public_rate_window'
wp option delete 'dfehc_enable_load_logging'
wp option delete 'dfehc_log_retention_seconds'
wp option delete 'dfehc_log_retention_max'
wp option delete 'dfehc_prune_chunk_size'
wp option delete 'dfehc_unclogger_settings'
wp option delete 'dfehc_heartbeat_control_enabled'
wp option delete 'dfehc_server_load_logs'
wp option delete 'dfehc_server_load_logs_last_saved'
wp option delete 'dfehc_update_load_logs_option'
wp option delete 'dfehc_max_response_time'
wp option delete 'dfehc_ema_alpha'

# Delete Transients
wp transient delete 'dfehc_optimization_flash'
wp transient delete 'dfehc_optimizing'
wp db query "DELETE FROM wp_options WHERE option_name LIKE '_transient_%_t' OR option_name LIKE '_site_transient_%_t'"
wp transient delete 'dfehc_heartbeat_health_status'

# Clear Cron Jobs
wp cron event delete 'dfehc_async_optimize_all'
wp cron event delete 'dfehc_log_server_load_hook'
wp cron event delete 'dfehc_periodic_optimization'
wp cron event delete 'dfehc_process_user_activity'
wp cron event delete 'dfehc_cleanup_user_activity'
wp cron event delete 'dfehc_reset_total_visitors_event'

# Direct DB Queries (Fallback)
wp db query "DELETE FROM wp_postmeta WHERE meta_key = 'dfehc_user_activity'"
wp db query "DELETE FROM wp_usermeta WHERE meta_key = 'dfehc_user_activity'"
wp db query "DELETE FROM wp_termmeta WHERE meta_key = 'dfehc_user_activity'"
wp db query "DELETE FROM wp_commentmeta WHERE meta_key = 'dfehc_user_activity'"
